<!DOCTYPE html>
<meta charset="utf-8">

<head>
  <meta http-equiv='cache-control' content='no-cache'>
  <meta http-equiv='expires' content='0'>
  <meta http-equiv='pragma' content='no-cache'>

  <title>ARR Dashboard</title>


  <!-- Bootstrap core CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">

  <!-- <link href="https://fonts.googleapis.com/css?family=Playfair&#43;Display:700,900&amp;display=swap" rel="stylesheet"> -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>

<body>


  <!-- Create a div where the graph will take place -->

  <div class="container">
    <header class="blog-header pb-2 pt-4">
      <div class="row flex-nowrap justify-content-between align-items-center">
        <div class="col-3 pt-1">
          <!-- <a class="link-secondary" href="#">Subscribe</a> -->
        </div>
        <div class="col-6 text-center">
          <div class="row justify-content-center">
            <div class="col-3 align-self-center">
              <img src="/ARR.png" class="img-fluid">
            </div>
          </div>
          <strong><a class="blog-header-logo text-dark pt-2" href="#">ARR Statistics</a></strong>
        </div>
        <div class="col-3 d-flex justify-content-end align-items-center">
          <!-- <a class="link-secondary" href="#" aria-label="Search">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="mx-3" role="img" viewBox="0 0 24 24"><title>Search</title><circle cx="10.5" cy="10.5" r="7.5"/><path d="M21 21l-5.2-5.2"/></svg>
          </a> -->
          <!-- <a class="btn btn-sm btn-outline-secondary" href="#">Sign up</a> -->
        </div>
      </div>
    </header>
    <div class="mt-4 text-muted d-flex justify-content-center">
      <!-- <span class="mr-auto">ACL Rolling Review: <br><a target="_blank" href="https://aclrollingreview.org/">aclrollingreview.org</a></span> -->
      <span class="ml-auto text-center">Report bugs or request for new statistics <br><a target="_blank"
          href="https://github.com/acl-org/arr-health/issues"><img
            src="https://img.shields.io/github/issues/acl-org/arr-health?color=green&label=acl-org%2Farr-health&logo=github"></a></span>
    </div>
    <h2 class="mt-3"><i class="fas fa-chart-line"></i> &nbsp;Conference Statistics</h2>
    <div class="row mt-4">
      <div class="col-12">
        <h4>Number of Submissions</h4>
        <div id="allsubsviz"></div>
      </div>
    </div>
    <div class="mt-3 text-center">
      <a class="btn btn-outline-primary" href="/submissions/explorer/"><i class="fab fa-wpexplorer"></i> &nbsp;Paper
        Explorer</a>
      <a class="btn btn-outline-primary" href="/submissions/word-clouds/"><i class="fas fa-sort-alpha-down"></i>
        &nbsp;Word Clouds</a>
      <a class="btn btn-outline-primary" href="/submissions/linguistic-diversity/"><i class="fas fa-language"></i>
        &nbsp;Linguistic Diversity</a>
      <a class="btn btn-outline-primary" href="/submissions/geo-diversity/"><i class="fas fa-globe-africa"></i>
        &nbsp;Geographic Diversity</a>
    </div>

    <h2 class="mt-5 pt-5"><i class="fas fa-user-friends"></i> &nbsp;Review Statistics</h2>
    <div class="row mt-4">
      <div class="col-lg-6 col-md-12">
        <h4>Assigned Area Chairs</h4>
        <div id="aeviz"></div>
      </div>
      <div class="col-lg-6 col-md-12">
        <h4>Assigned Reviewers</h4>
        <div id="revviz"></div>
      </div>
    </div>

    <div class="row mt-4">
      <div class="col-lg-6 col-md-12">
        <h4>Requested vs. Returned Meta Reviews</h4>
        <div id="mreviewviz"></div>
      </div>
      <div class="col-lg-6 col-md-12">
        <h4>Requested vs. Returned Reviews</h4>
        <div id="reviewviz"></div>
      </div>
    </div>

    <h2 class="mt-5 pt-5"><i class="fas fa-redo"></i> &nbsp;Resubmission Statistics</h2>
    <div class="row mt-4">
      <div class="col-lg-6 col-md-12">
        <h4>Meta Review Score Changes</h4>
        <div id="mrev-resubs"></div>
      </div>
      <div class="col-lg-6 col-md-12">
        <h4>Review Score Changes</h4>
        <div id="rev-resubs"></div>
      </div>
    </div>

    <h2 class="mt-5 pt-5"><i class="fas fa-stream"></i> &nbsp;Check Individual Iteration Statistics</h2>
    <h5 class="my-4 text-muted">Click (<i class="fas fa-hand-pointer"></i>) on the ARR iteration you want to check more
    </h5>
    <!-- style="color: #bf360c" -->
    <h1 class="my-3"><strong class="text-dark" href="#">2024</strong></h1>
    <div id="iterations-2024" class="mt-3 row iterations">
    </div>
    <h1 class="my-3"><strong class="text-dark" href="#">2023</strong></h1>
    <div id="iterations-2023" class="mt-3 row iterations">
    </div>
    <h1 class="my-3"><strong class="text-dark" href="#">2022</strong></h1>
    <div id="iterations-2022" class="mt-3 row iterations">
    </div>
    <h1 class="my-3"><strong class="text-dark" href="#">2021</strong></h1>
    <div id="iterations-2021" class="mt-3 row iterations">
    </div>


    <footer class="py-3 my-4">
      <!-- <p class="text-center text-muted">Sebastin Santy, University of Washington</p> -->
    </footer>
  </div>
</body>
<style>
  .counter {
    color: #999
  }

  .counter-h3 {
    color: #999
  }

  .card-img-top {
    width: 100%;
    height: 100%;
    /* height: 15vw; */
    object-fit: cover;
    opacity: 0.2;
  }

  div.tooltip {
    position: absolute;
    text-align: center;
    width: 60px;
    height: 10px;
    padding: 2px;
    font: 12px sans-serif;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
  }

  .npointer {
    cursor: pointer;
  }

  .monthcard:hover {
    border: 1px solid #aaa;
    transition-duration: 0.2s;
  }

  .monthcard:hover .card-img-top {
    opacity: 0.4;
    transition-duration: 0.2s;
  }
</style>
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>
<script src="https://d3js.org/d3-collection.v1.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<script>
  var meta_color = "#e64a19"
  var review_color = "#1976d2"

  d3.json('months.json').then(function (data) {

    months = []

    for (const [k, v] of Object.entries(data)) {
      months.push([k, v])
    }

    var month_stats = []

    $('.iterations').html('')

    var total_subs = []
    var total_resubs = []
    var aes = []
    var revs = []

    var reviews = []
    var mreviews = []

    var parseDate = d3.timeParse("%Y-%m-%d");
    var formatDate = d3.timeFormat("%d %b %Y");

    function dtom(date) {
      splits = date.split('-')
      return splits[0] + '-' + splits[1] + '-01'
    }

    for (i = 0; i < months.length; i++) {
      var submissions = 0;
      var review_progress = 0;
      var meta_progress = 0;
      var k = months[i][0];
      var month = k.split('/')[1];
      var year = k.split('/')[0];
      var v = "iterations/" + k + "/banner.png";
      var imgpath = "banner.png";
      const dir = "iterations/";

      // Check if the image exists at 'v'
      $.ajax({
        url: v,
        type: 'HEAD',
        error: function () {
          // If the image doesn't exist, load the image from 'img/{month}.png'
          v = "img/" + month + ".png";
        },
        success: function () {
          // The image exists at 'v', so continue with the regular code
          $.ajax({
            dataType: "json",
            url: dir + k + '/dashboard_stats.json',
            async: false,
            success: function (data) {
              submissions = data['submissions'];
              resubmissions = data['resubmissions'];
              review_progress = data['rev-progress'];
              meta_progress = data['meta-progress'];
              iteration = data['iteration'];
              update_date = formatDate(parseDate(data['update-date']));

              sub_deadline = data['submission-deadline'];
              total_subs.push({ 'submissions': submissions, 'month': parseDate(dtom(sub_deadline)) });
              total_resubs.push({ 'submissions': resubmissions, 'month': parseDate(dtom(sub_deadline)) });

              ae_pool = data['ae-pool'];
              rev_pool = data['rev-pool'];
              ae_assigned = data['ae-assigned'];
              rev_assigned = data['rev-assigned'];
              aes.push({ 'total': ae_pool, 'assigned': ae_assigned, 'month': parseDate(dtom(sub_deadline)) });
              revs.push({ 'total': rev_pool, 'assigned': rev_assigned, 'month': parseDate(dtom(sub_deadline)) });

              requested_revs = data['requested-revs'];
              returned_revs = data['returned-revs'];
              requested_mrevs = data['requested-mrevs'];
              returned_mrevs = data['returned-mrevs'];
              reviews.push({ 'requested': requested_revs, 'returned': returned_revs, 'month': parseDate(dtom(sub_deadline)) });
              mreviews.push({ 'requested': requested_mrevs, 'returned': returned_mrevs, 'month': parseDate(dtom(sub_deadline)) });

              $('#iterations' + '-' + year).append(`
                          <div class="col-lg-4 col-md-12">
                          <a href="/` + dir + k + `/">
                          <div class="card img-fluid flex-md-row mb-4 shadow h-md-250 monthcard">
                              <img class="card-img-top" src="` + v + `">
                              <div class="card-img-overlay">
                                  <div class="card-body d-flex flex-column align-items-start align-self-end">
                                  <h2 class="mb-0">
                                      <strong class="text-dark" href="#">` + iteration + `</strong>
                                  </h2>
                                  <!-- <div class="mb-1 text-muted">Nov 12</div> -->
                                  <h6 class="mt-2 card-text text-dark mb-auto">Submissions: ` + submissions + ` <br> Paper Progress: ` + review_progress + `% <br> Meta Review Progress: ` + meta_progress + `%</h6><p class="text-muted font-italic">(Updated on: ` + update_date + `)</p>
                                  <!-- <a href="#">Continue reading</a> -->
                                  </div>
                              </div>
                          </div>
                          </a>
                          </div>
              `);
            }
          });
        }
      });
    };

    $(function () {
      $.each(document.images, function () {
        var this_image = this;
        var src = $(this_image).attr('src') || '';
        if (!src.length > 0) {
          //this_image.src = options.loading; // show loading
          var lsrc = $(this_image).attr('lsrc') || '';
          if (lsrc.length > 0) {
            var img = new Image();
            img.src = lsrc;
            $(img).on('load', function () {
              this_image.src = this.src;
            });
          }
        }
      });
    });

    var div = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 1);

    function draw_times(selector) {

      margin = { top: 10, right: 30, bottom: 30, left: 40 },
        width = 1200 - margin.left - margin.right,
        height = 250 - margin.top - margin.bottom;

      var x = d3.scaleTime()
        .domain([d3.min(total_subs, function (d) { return d.month }), d3.max(total_subs, function (d) { return d.month })])
        .rangeRound([0, width]);

      var y = d3.scaleLinear()
        .domain([0, d3.max(total_subs, function (d) { return 1.1 * d.submissions })])
        .range([height, 0]);

      var netHeight = (height + margin.top + margin.bottom)
      var netWidth = (width + margin.left + margin.right)
      var svg = d3.select(selector).append("svg")
        .attr("viewBox", `0 0 ` + netWidth + ` ` + netHeight)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      svg.append("path")
        .datum(total_subs)
        .transition()
        .delay(function (d, i) { return 1000 * i; })
        .duration(1200)
        .attr("fill", "none")
        .attr("stroke", "#000")
        .attr("stroke-width", 1.5)
        .attr("stroke-linejoin", "round")
        .attr("d", d3.line()
          .curve(d3.curveCardinal.tension(0.8))
          .x(function (d) { return x(d.month); })
          .y(function (d) { return y(d.submissions); }));

      svg.selectAll("g.dot")
        .data(total_subs)
        .enter().append('g')
        .append("circle")
        .attr("class", "npointer")
        .attr("cx", function (d) { return x(d.month); })
        .attr("cy", function (d) { return y(d.submissions); })
        .attr("r", 4)
        .style("stroke", "#000")
        .attr("stroke-width", 2)
        .style("fill", "#fff")
        .on("mouseover", function (i, d) {
          div.transition()
            .duration(100)
            .style("opacity", .9);
          div.html(d.submissions)
            .style("left", (event.pageX - 20) + "px")
            .style("top", (event.pageY - 20) + "px");
        })
        .on("mouseout", function (d) {
          div.transition()
            .duration(500)
            .style("opacity", 0);
        });

      svg.append("path")
        .datum(total_resubs)
        .transition()
        .delay(function (d, i) { return 1000 * i; })
        .duration(1200)
        .attr("fill", "none")
        .attr("stroke", "#999")
        .attr("stroke-width", 1.5)
        .attr("stroke-linejoin", "round")
        .attr("d", d3.line()
          .curve(d3.curveCardinal.tension(0.8))
          .x(function (d) { return x(d.month); })
          .y(function (d) { return y(d.submissions); }));

      svg.selectAll("g.dot")
        .data(total_resubs)
        .enter().append('g')
        .append("circle")
        .attr("class", "npointer")
        .attr("cx", function (d) { return x(d.month); })
        .attr("cy", function (d) { return y(d.submissions); })
        .attr("r", 4)
        .style("stroke", "#aaa")
        .attr("stroke-width", 2)
        .style("fill", "#fff")
        .on("mouseover", function (i, d) {
          div.transition()
            .duration(100)
            .style("opacity", .9);
          div.html(d.submissions)
            .style("left", (event.pageX - 20) + "px")
            .style("top", (event.pageY - 20) + "px");
        })
        .on("mouseout", function (d) {
          div.transition()
            .duration(500)
            .style("opacity", 0);
        });

      var legx = 25
      var legy = 10
      var legxoff = 15
      var legtext = "No. of submissions"

      svg.append('line')
        .style("stroke", "#000")
        .style("stroke-width", 1.5)
        .attr("x1", legx - legxoff)
        .attr("y1", legy)
        .attr("x2", legx + legxoff)
        .attr("y2", legy);

      svg.append("text")
        .attr("x", legx + 20)
        .attr("y", legy + 5)
        .text(legtext)
        .style("font-size", "13px")
        .attr("alignment-baseline", "middle")
        .attr("opacity", 0.7)

      svg.append("circle")
        .attr("cx", legx)
        .attr("cy", legy)
        .attr("r", 4)
        .style("stroke", "#000")
        .attr("stroke-width", 2)
        .style("fill", "#fff")

      var legx = 25
      var legy = 28
      var legxoff = 15
      var legtext = "No. of resubmissions"

      svg.append('line')
        .style("stroke", "#aaa")
        .style("stroke-width", 1.5)
        .attr("x1", legx - legxoff)
        .attr("y1", legy)
        .attr("x2", legx + legxoff)
        .attr("y2", legy);

      svg.append("text")
        .attr("x", legx + 20)
        .attr("y", legy + 5)
        .text(legtext)
        .style("font-size", "13px")
        .attr("alignment-baseline", "middle")
        .attr("opacity", 0.7)

      svg.append("circle")
        .attr("cx", legx)
        .attr("cy", legy)
        .attr("r", 4)
        .style("stroke", "#aaa")
        .attr("stroke-width", 2)
        .style("fill", "#fff")

      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

      svg.append("g")
        .call(d3.axisLeft(y));
    }

    draw_times("#allsubsviz")


    function draw_reviewers(selector, type) {

      margin = { top: 10, right: 30, bottom: 30, left: 40 },
        width = 600 - margin.left - margin.right,
        height = 250 - margin.top - margin.bottom;

      if (type == "review") {
        data = revs
        color = review_color
        legtext = "Assigned Reviewers"
      } else {
        data = aes
        color = meta_color
        legtext = "Assigned Area Chairs"
      }

      non_null_data = data.filter(d => d.assigned !== null)

      var x = d3.scaleTime()
        .domain([d3.min(data, function (d) { return d.month }), d3.max(data, function (d) { return d.month })])
        .rangeRound([0, width]);

      var y = d3.scaleLinear()
        .domain([0, d3.max(data, function (d) { return 1.2 * d.assigned })])
        .range([height, 0]);

      var netHeight = (height + margin.top + margin.bottom)
      var netWidth = (width + margin.left + margin.right)

      var svg = d3.select(selector).append("svg")
        .attr("viewBox", `0 0 ` + netWidth + ` ` + netHeight)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      // svg.append("path")
      // .datum(data)
      // .transition()
      // .delay(function(d,i){ return 1000*i; }) 
      // .duration(1200)
      // .attr("fill", "none")
      // .attr("stroke", "#ddd")
      // .attr("stroke-width", 1.5)
      // .attr("stroke-linejoin", "round")
      // .attr("d",  d3.line()
      // .curve(d3.curveCardinal.tension(0.8))
      // .x(function(d) { return x(d.month); })
      // .y(function(d) { return y(d.total); }));


      svg.append("path")
        .datum(non_null_data)
        .transition()
        .delay(function (d, i) { return 1000 * i; })
        .duration(1200)
        .attr("fill", "none")
        .attr("stroke", color)
        .attr("stroke-width", 1.5)
        .attr("stroke-linejoin", "round")
        .attr("d", d3.line()
          .curve(d3.curveCardinal.tension(0.8))
          .x(function (d) { return x(d.month); })
          .y(function (d) { return y(d.assigned); }));


      svg.selectAll("g.dot")
        .data(non_null_data)
        .enter().append('g')
        .append("circle")
        .attr("class", "npointer")
        .attr("cx", function (d) { return x(d.month); })
        .attr("cy", function (d) { return y(d.assigned); })
        .attr("r", 4)
        .style("stroke", color)
        .attr("stroke-width", 2)
        .style("fill", "#fff")
        .on("mouseover", function (i, d) {
          div.transition()
            .duration(100)
            .style("opacity", .9);
          // console.log()
          div.html(d.assigned)
            .style("left", (event.pageX - 20) + "px")
            .style("top", (event.pageY - 20) + "px");
        })
        .on("mouseout", function (d) {
          div.transition()
            .duration(500)
            .style("opacity", 0);
        });

      legx = 25
      legy = 10
      legxoff = 15
      // legtext = "Total"

      // svg.append('line')
      // .style("stroke", "#ddd")
      // .style("stroke-width", 1.5)
      // .attr("x1", legx-legxoff)
      // .attr("y1", legy)
      // .attr("x2", legx+legxoff)
      // .attr("y2", legy);

      // svg.append("text")
      // .attr("x", legx + 20)
      // .attr("y", legy + 5)
      // .text(legtext)
      // .style("font-size", "13px")
      // .attr("alignment-baseline","middle")
      // .attr("opacity", 0.7)

      // legx = 25
      // legy = 28
      // legxoff = 15
      // legtext = "Assigned"

      svg.append('line')
        .style("stroke", color)
        .style("stroke-width", 1.5)
        .attr("x1", legx - legxoff)
        .attr("y1", legy)
        .attr("x2", legx + legxoff)
        .attr("y2", legy);

      svg.append("text")
        .attr("x", legx + 20)
        .attr("y", legy + 5)
        .text(legtext)
        .style("font-size", "13px")
        .attr("alignment-baseline", "middle")
        .attr("opacity", 0.7)

      svg.append("circle")
        .attr("cx", legx)
        .attr("cy", legy)
        .attr("r", 4)
        .style("stroke", color)
        .attr("stroke-width", 2)
        .style("fill", "#fff")

      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

      svg.append("g")
        .call(d3.axisLeft(y));
    }

    draw_reviewers("#aeviz", "meta")
    draw_reviewers("#revviz", "review")

    function draw_reviews(selector, type) {

      margin = { top: 10, right: 30, bottom: 30, left: 40 },
        width = 600 - margin.left - margin.right,
        height = 250 - margin.top - margin.bottom;

      if (type == "review") {
        data = reviews
        color = review_color
        legtext = "No. of Reviews"
      } else {
        data = mreviews
        color = meta_color
        legtext = "No. of Meta Reviews"
      }

      // non_null_data = data.filter(d => d.assigned !== null)

      var x = d3.scaleTime()
        .domain([d3.min(data, function (d) { return d.month }), d3.max(data, function (d) { return d.month })])
        .rangeRound([0, width]);

      var y = d3.scaleLinear()
        .domain([0, d3.max(data, function (d) { return 1.2 * d.requested })])
        .range([height, 0]);

      var netHeight = (height + margin.top + margin.bottom)
      var netWidth = (width + margin.left + margin.right)

      var svg = d3.select(selector).append("svg")
        .attr("viewBox", `0 0 ` + netWidth + ` ` + netHeight)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

      svg.append("path")
        .datum(data)
        .transition()
        .delay(function (d, i) { return 1000 * i; })
        .duration(1200)
        .attr("fill", "none")
        .attr("stroke", "#ddd")
        .attr("stroke-width", 1.5)
        .attr("stroke-linejoin", "round")
        .attr("d", d3.line()
          .curve(d3.curveCardinal.tension(0.8))
          .x(function (d) { return x(d.month); })
          .y(function (d) { return y(d.requested); }));


      svg.append("path")
        .datum(data)
        .transition()
        .delay(function (d, i) { return 1000 * i; })
        .duration(1200)
        .attr("fill", "none")
        .attr("stroke", color)
        .attr("stroke-width", 1.5)
        .attr("stroke-linejoin", "round")
        .attr("d", d3.line()
          .curve(d3.curveCardinal.tension(0.8))
          .x(function (d) { return x(d.month); })
          .y(function (d) { return y(d.returned); }));


      svg.selectAll("g.dot")
        .data(data)
        .enter().append('g')
        .append("circle")
        .attr("class", "npointer")
        .attr("cx", function (d) { return x(d.month); })
        .attr("cy", function (d) { return y(d.returned); })
        .attr("r", 4)
        .style("stroke", color)
        .attr("stroke-width", 2)
        .style("fill", "#fff")
        .on("mouseover", function (i, d) {
          div.transition()
            .duration(100)
            .style("opacity", .9);
          // console.log()
          div.html(d.returned)
            .style("left", (event.pageX - 20) + "px")
            .style("top", (event.pageY - 20) + "px");
        })
        .on("mouseout", function (d) {
          div.transition()
            .duration(500)
            .style("opacity", 0);
        });

      legx = 25
      legy = 10
      legxoff = 15
      legtext = "ARR Requested"

      svg.append('line')
        .style("stroke", "#ddd")
        .style("stroke-width", 1.5)
        .attr("x1", legx - legxoff)
        .attr("y1", legy)
        .attr("x2", legx + legxoff)
        .attr("y2", legy);

      svg.append("text")
        .attr("x", legx + 20)
        .attr("y", legy + 5)
        .text(legtext)
        .style("font-size", "13px")
        .attr("alignment-baseline", "middle")
        .attr("opacity", 0.7)

      legx = 25
      legy = 28
      legxoff = 15
      legtext = "Reviews Completed"

      svg.append('line')
        .style("stroke", color)
        .style("stroke-width", 1.5)
        .attr("x1", legx - legxoff)
        .attr("y1", legy)
        .attr("x2", legx + legxoff)
        .attr("y2", legy);

      svg.append("text")
        .attr("x", legx + 20)
        .attr("y", legy + 5)
        .text(legtext)
        .style("font-size", "13px")
        .attr("alignment-baseline", "middle")
        .attr("opacity", 0.7)

      svg.append("circle")
        .attr("cx", legx)
        .attr("cy", legy)
        .attr("r", 4)
        .style("stroke", color)
        .attr("stroke-width", 2)
        .style("fill", "#fff")

      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

      svg.append("g")
        .call(d3.axisLeft(y));
    }

    draw_reviews("#mreviewviz", "meta")
    draw_reviews("#reviewviz", "review")

    function draw_resubs(selector, type) {

      if (type == "review") {
        file = "resub_rev.csv"
      } else {
        file = "resub_meta.csv"
      }

      d3.csv(file).then(function (data) {
        max_counter = 0
        data_arr = []
        data_arr_f = []

        if (type == "review") {
          color = review_color
        } else {
          color = meta_color
        }

        data.forEach(function (d) {

          var counter = 0
          data_ins = []
          for (const [_, num] of Object.entries(d)) {
            counter += 1
            if (num != "") {
              data_ins.push({ "iteration": 'Iteration ' + counter, "value": parseFloat(num) })
              data_arr_f.push({ "iteration": 'Iteration ' + counter, "value": parseFloat(num) })
            }
            // else {
            // data_ins[counter] = 0.0
            // }
          }
          data_arr.push(data_ins)
          if (counter > max_counter) {
            max_counter = counter
          }
        })

        xdomain = []
        for (i = 1; i <= max_counter; i++) {
          xdomain.push("Iteration " + i)
        }

        margin = { top: 10, right: 30, bottom: 30, left: 40 },
          width = 600 - margin.left - margin.right,
          height = 250 - margin.top - margin.bottom;

        var x = d3.scaleBand()
          .domain(xdomain)
          .paddingInner(1)
          .paddingOuter(.5)
          .rangeRound([0, width]);

        var y = d3.scaleLinear()
          .domain([-3, 3])
          .range([height, 0]);

        var netHeight = (height + margin.top + margin.bottom)
        var netWidth = (width + margin.left + margin.right)

        var svg = d3.select(selector).append("svg")
          .attr("viewBox", `0 0 ` + netWidth + ` ` + netHeight)
          .append("g")
          .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");



        function hexToRgbA(hex, alpha) {
          var c;
          if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {
            c = hex.substring(1).split('');
            if (c.length == 3) {
              c = [c[0], c[0], c[1], c[1], c[2], c[2]];
            }
            c = '0x' + c.join('');
            return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ',' + alpha + ')';
          }
          throw new Error('Bad Hex');
        }



        var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
          .key(function (d) { return d.iteration; })
          .rollup(function (d) {
            q1 = d3.quantile(d.map(function (g) { return g.value; }).sort(d3.ascending), .25)
            median = d3.quantile(d.map(function (g) { return g.value; }).sort(d3.ascending), .5)
            q3 = d3.quantile(d.map(function (g) { return g.value; }).sort(d3.ascending), .75)
            interQuantileRange = q3 - q1
            min = q1 - 1.5 * interQuantileRange
            max = q3 + 1.5 * interQuantileRange
            return ({ q1: q1, median: median, q3: q3, interQuantileRange: interQuantileRange, min: min, max: max })
          })
          .entries(data_arr_f)


        svg
          .selectAll("vertLines")
          .data(sumstat)
          .enter()
          .append("line")
          .attr("x1", function (d) { return (x(d.key)) })
          .attr("x2", function (d) { return (x(d.key)) })
          .attr("y1", function (d) { return (y(d.value.min)) })
          .attr("y2", function (d) { return (y(d.value.max)) })
          .attr("stroke", "#999")
          .style("stroke-width", 1)
          .style("width", 40)



        data_arr.forEach(function (linea) {
          svg.append("path")
            .datum(linea)
            .transition()
            .delay(function (d, i) { return 1000 * i; })
            .duration(1200)
            .attr("fill", "none")
            .attr("stroke", hexToRgbA("#ddd", 0.1))
            .attr("stroke-width", 1)
            .attr("stroke-linejoin", "round")
            .attr("d", d3.line()
              .curve(d3.curveCardinal.tension(0))
              .x(function (d) { return x(d.iteration); })
              .y(function (d) { return y(d.value); }));


          svg.selectAll("g.dot")
            .data(linea)
            .enter().append('g')
            .append("circle")
            .attr("cx", function (d) { return x(d.iteration); })
            .attr("cy", function (d) { return y(d.value); })
            .attr("r", 1)
            .style("stroke", color)
            .attr("stroke-width", 1)
            .style("fill", color)

        })

        // rectangle for the main box
        var boxWidth = 40
        svg
          .selectAll("boxes")
          .data(sumstat)
          .enter()
          .append("rect")
          .attr("x", function (d) { return (x(d.key) - boxWidth / 2) })
          .attr("y", function (d) { return (y(d.value.q3)) })
          .attr("height", function (d) { return (y(d.value.q1) - y(d.value.q3)) })
          .attr("width", boxWidth)
          .attr("stroke", color)
          .style("stroke-width", 1.8)
          .style("fill", "none")

        // Show the median
        svg
          .selectAll("medianLines")
          .data(sumstat)
          .enter()
          .append("line")
          .attr("x1", function (d) { return (x(d.key) - boxWidth / 2) })
          .attr("x2", function (d) { return (x(d.key) + boxWidth / 2) })
          .attr("y1", function (d) { return (y(d.value.median)) })
          .attr("y2", function (d) { return (y(d.value.median)) })
          .attr("stroke", color)
          .style("stroke-width", 1.4)
          .style("width", 80)



        svg.append('line')
          .style("stroke", "#000")
          .style("stroke-width", 1)
          .style("stroke-dasharray", ("3, 3"))
          .attr("x1", 0)
          .attr("y1", y(0))
          .attr("x2", width)
          .attr("y2", y(0));

        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        svg.append("g")
          .call(d3.axisLeft(y));
      })
    }

    draw_resubs("#mrev-resubs", "meta")
    draw_resubs("#rev-resubs", "review")

  });
</script>

</html>